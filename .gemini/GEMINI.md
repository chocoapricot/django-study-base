## アプリケーションの概要と特徴

このDjangoアプリケーションは、多機能なWebアプリケーションであり、以下の主要な特徴を持っています。

*   **Djangoフレームワーク**: Python製のWebフレームワークDjangoを基盤としています。
*   **カスタムユーザーモデル**: `apps/accounts/MyUser`を認証に利用しており、柔軟なユーザー管理が可能です。
*   **認証システム**: `django-allauth`を導入し、メールアドレスを主とした認証（サインアップ、ログイン、パスワードリセットなど）を提供しています。
*   **モジュール化された機能**: `api`, `staff`, `client`, `contract`, `company`, `common`, `master`, `system`, `accounts`といった複数のDjangoアプリケーションに機能を分割し、高いモジュール性と保守性を実現しています。特に`system`アプリケーションは、`settings`（ドロップダウン、メニュー、パラメータを統合）、`logs`といったサブモジュールに再編され、ユーザー管理機能は独立した`accounts`アプリに移行されました。
*   **国際化対応**: 日本語環境（`ja-JP`）での利用を前提とした設定が施されています。
*   **データ管理機能**: ExcelやPDF形式でのデータ出力機能、管理画面でのインポート/エクスポート機能（`django-import-export`）を備えています。
*   **外部サービス連携**: `gBizINFO`や`zipcloud`などの外部APIとの連携機能を有しています。
*   **ログ記録**: ユーザーのログイン/ログアウトなどのアクションを記録する認証ログ機能を実装しています。
*   **契約管理機能**: クライアント契約とスタッフ契約の包括的な管理機能を提供し、契約の作成、更新、削除、状況追跡（有効期間中、開始前、期限切れ、無効）が可能です。
*   **統一変更履歴システム**: `AppLog`モデルを使用して、スタッフ、クライアント、契約などすべてのデータ変更を統一的に追跡・表示する仕組みを実装しています。各詳細画面で変更履歴を確認でき、操作者・日時・変更内容を記録します。

## 開発方針

既存の指針に加え、以下の点を重視して開発を進めます。

*   **シンプルで保守性の高いコード**: ソースコードは常にシンプルさを追求し、長期的な保守性を確保します。
*   **堅牢なセキュリティ**: ユーザー認証、データ保護、アクセス制御など、アプリケーション全体のセキュリティを最優先します。
*   **既存ライブラリの積極的な活用**: `django-allauth`や`python-stdnum==2.1`、その他の信頼性の高いミドルウェア、ライブラリを積極的に活用し、独自実装を最小限に抑えることで、開発効率と品質を向上させます。
*   **テストによる品質保証**: 作成された機能は、適切なテスト（単体テスト、結合テストなど）によって品質が保証されるようにします。

### 開発プロセスにおける追加の指針

*   **コミュニケーション言語**: エージェントとのやり取りは日本語で行う。

*   **home.htmlのMiddleware欄に、利用しているコンポーネントを記載する。**
    **新しいライブラリを追加した場合は、必ずこの欄に追記すること。**
*   **プログラムを追加した場合には、テストケースを追加し、テストケースが通るようにする。**
*   **テストケースが完了するまで修正を行う。時間がかかっている場合には一度方針について確認を行う。**
*   **テストケースが長い場合には修正する前にファイルを分割して実行しやすいようにする。修正は分割した後。**
*   **画面に表示する日時は `YYYY/MM/DD HH:MM:SS` の形式に統一する。**
*   **変更履歴の統一**: すべてのモデルで`AppLog`を使用した統一的な変更履歴管理を行う。詳細画面には必ず変更履歴セクションを追加し、同じ形式で表示する。
*   **CHANGELOG.mdの更新**: 変更履歴は`CHANGELOG.md`に記録する。フォーマットは「Keep a Changelog」に準拠し、セマンティックバージョニングに従う。各変更は「Added」「Changed」「Removed」のいずれかのセクションに分類し、簡潔かつ具体的に記述する。