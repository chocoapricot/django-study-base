#!/usr/bin/env python
"""
ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ã‚¤ãƒ³ãƒãƒ¼ãƒˆã‚¹ã‚¯ãƒªãƒ—ãƒˆ
æ­£ã—ã„é †åºã§ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆã—ã¾ã™ã€‚
"""

import os
import sys
import subprocess

# å…±é€šè¨­å®šã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆ
from sample_data_config import SAMPLE_DATA_FILES


def run_command(command, description):
    """ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã€çµæœã‚’è¡¨ç¤º"""
    print(f"\n{description}")
    print(f"å®Ÿè¡Œä¸­: {command}")
    result = subprocess.run(command, shell=True, capture_output=True, text=True)
    
    if result.returncode == 0:
        print("âœ… æˆåŠŸ")
        if result.stdout:
            print(result.stdout)
    else:
        print("âŒ ã‚¨ãƒ©ãƒ¼")
        if result.stderr:
            print(result.stderr)
        return False
    return True


def main():
    print("ğŸ“Š ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ã®ã‚¤ãƒ³ãƒãƒ¼ãƒˆã‚’é–‹å§‹ã—ã¾ã™...")
    
    # ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚¡ã‚¤ãƒ«ã®å­˜åœ¨ç¢ºèª
    missing_files = []
    for file_path, _ in SAMPLE_DATA_FILES:
        if not os.path.exists(file_path):
            missing_files.append(file_path)
    
    if missing_files:
        print("âŒ ä»¥ä¸‹ã®ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚¡ã‚¤ãƒ«ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“:")
        for file_path in missing_files:
            print(f"  - {file_path}")
        sys.exit(1)
    
    # ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ã‚’é †æ¬¡èª­ã¿è¾¼ã¿
    for file_path, description in SAMPLE_DATA_FILES:
        command = f"python manage.py loaddata {file_path}"
        if not run_command(command, description):
            print(f"âŒ {description}ã®ã‚¤ãƒ³ãƒãƒ¼ãƒˆã§ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ")
            sys.exit(1)

    # ã‚¹ãƒ¼ãƒ‘ãƒ¼ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å§“åã‚’æ›´æ–°
    update_superuser_command = "python manage.py update_superuser_info"
    if not run_command(update_superuser_command, "ã‚¹ãƒ¼ãƒ‘ãƒ¼ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å§“åã€ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’æ›´æ–°"):
        print("âŒ ã‚¹ãƒ¼ãƒ‘ãƒ¼ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æ›´æ–°ã§ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ")
        sys.exit(1)
    
    print("\nğŸ‰ ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ã®ã‚¤ãƒ³ãƒãƒ¼ãƒˆãŒå®Œäº†ã—ã¾ã—ãŸï¼")
    print("\nğŸ“ˆ ã‚¤ãƒ³ãƒãƒ¼ãƒˆã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿:")
    for _, description in SAMPLE_DATA_FILES:
        print(f"- {description}")


if __name__ == "__main__":
    main()