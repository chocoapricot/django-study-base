# 変更履歴

## 2026-02-15

### Changed
- HOME画面の「業務サマリ」および「登録状況」セクションにおいて、要素の高さが揃うように改善しました。
    - CSSで `stats-card` クラスに `height: 100%` を追加し、グリッド内でカードの高さが統一されるようにしました。
    - `_stats_card.html` テンプレートを修正し、リンク（`<a>`）が含まれる場合でも高さが正しく継承されるよう `h-100 d-block` クラスを追加しました。

## 2026-02-14

### Fixed
- 個人抵触日管理一覧（`/contract/staff/teishokubi/`）において、サンプルデータが存在するにもかかわらずリストが空になる不具合を修正しました。
    - 原因：自動生成された `StaffContractTeishokubi` レコードに `tenant_id` が設定されていなかったため、マルチテナントのフィルタリングにより除外されていました。
    - 修正内容：
        - `TeishokubiCalculator` に `tenant_id` を渡すように拡張し、新規作成・更新時に正しく `tenant_id` をセットするようにしました。
        - 既存の `tenant_id` が `None` のレコードを、関連する契約から特定した正しい `tenant_id` に修復しました。
- `apps/contract/views_haken.py` と `apps/contract/views_staff.py` の間で、個人抵触日関連のビュー関数が重複して定義されていた問題を修正し、両方のバージョンの不整合を解消しました。


## 2026-02-07

### Changed
- スタッフ等級一括変更画面（`/staff/grade/bulk_change/`）のデザインを他の一覧画面と統一しました。
    - テーブルのヘッダーから暗色（`table-dark`）を削除し、標準的なスタイルに変更しました。
    - 「スタッフ一覧へ戻る」ボタンを削除しました。
    - 「一括変更」ボタンを画面中央から左下に移動しました。
    - 現状の等級の「開始日」および「経過期間（何年何か月）」を表示するように機能拡張しました。
    - 現状の等級に「等級コード」を併記するように変更しました。
    - スタッフ一覧画面と同様に、社員番号の右側にアラームや接続状況のアイコン、氏名の右側にお気に入りやステータス（外国籍・障害者）のアイコンを表示するようにしました。
    - プルダウンで等級を変更した際に、該当する行を `table-warning` で強調表示（ハイライト）するようにしました。
    - 画面の横スクロールを解消するため、レイアウトのレスポンシブ対応とカラム幅の最適化を行いました。
- スタッフ等級一括変更画面において、お気に入りや接続状況、アラームなどの各種アイコンが表示されない不具合を、ビュー側のクエリセットに適切な注釈（Annotate）を付与することで修正しました。
- `README.md` の情報を実際のプロジェクト構成、ミドルウェア、およびバージョンに合わせて最新の状態に更新しました。
    - Djangoのバージョンを 5.2.5 から 5.2.8 に更新しました。
    - 各主要ライブラリにバージョン番号を追記し、実際のプロジェクト環境（`requirements.txt`）と整合させました。
    - `apps/system/` 配下のフォルダ構成を実際のディレクトリ構造に合わせて修正しました。

## 2026-02-06

### Added
- スタッフ等級（`StaffGrade`）モデルを新設しました。スタッフごとに履歴（有効期間）を持たせて等級（等級コード）を管理可能にしました。

### Changed
- スタッフ等級編集画面（`/master/grade/`）をレスポンシブに対応させました。画面幅が狭い場合に項目名が左寄せになるように改善しました。
- スタッフ等級の一覧および編集画面において、「給与種別」と「金額」の表記を「基本単価」に統合・変更し、金額をカンマ区切りで表示するようにしました。
- スタッフ詳細画面の「評価」カードにおいて、評価が未登録（0件）の場合はカードの中身（ボディ部分）を空白で表示するように改善しました。
- スタッフモデルから「等級(grade)」フィールドを削除しました。これに伴い、編集画面および詳細画面、インポート/エクスポート機能からも等級関連の項目を削除しました。


## 2026-01-31

### Changed
- クライアント契約作成画面（`/contract/client/create/`）における勤怠打刻パターン選択モーダルのデザインを、スタッフ契約画面や時間外算出パターン選択モーダルと同様のテーブル形式に変更しました。
- 勤怠打刻パターン選択モーダルのページネーション動作を改善し、1ページのみの場合はページネーションを表示しないように修正しました。
- 契約関連モーダルのJavaScript処理をリファクタリングし、共通のレンダリング関数を使用するように統合しました。
- クライアント契約フォームから不要な時間外算出パターン関連のJavaScriptコードを削除し、エラーを修正しました。

## 2026-01-30

### Added
- `MyUser` モデルに `tenant_id` フィールドを追加しました。これにより、ユーザーアカウントレベルでのマルチテナント管理が可能になります。

### Changed
- 自社担当者のログインアカウント作成時に、担当者が所属する会社のテナントID（`tenant_id`）が自動的にユーザーアカウントに設定されるように修正しました。

## 2026-01-29

### Added
- スタッフの顔写真がない場合に、名前のイニシャルと性別色を組み合わせたCSSベースのプレースホルダー表示機能を追加しました。
    - これにより、スタッフ一覧画面などで顔写真がないスタッフが多数いる場合の表示速度が大幅に向上しました。
    - プレースホルダーは常に円形で表示され、可読性を重視したデザインになっています。
- スタッフのプレースホルダー画像をサーバー側で生成しキャッシュする機能を追加しました。
    - `/media/staff_files/placeholders/` にキャッシュされ、以降のアクセス速度を向上させます。
    - 名前や性別が変更された場合、または本人の写真がアップロードされた場合には自動的にキャッシュがクリアされます。
- `Staff` モデルに、プレースホルダー表示用の `initials`（イニシャル）および `avatar_color`（アバター背景色）プロパティを追加しました。

### Changed
- HOME画面の「利用技術」および「規定・書式」セクションをレスポンシブに対応させました。ブラウザの画面幅が狭い場合には各項目を縦並びに配置し、レイアウトが崩れないように改善しました。
- スタッフ一覧および詳細画面において、顔写真がない場合は backend の画像生成を待たずに即座にCSSでプレースホルダーを表示するように挙動を改善しました。

### Fixed
- 汎用の削除確認用テンプレート `common/common_delete.html` が存在しなかったため、マスタデータの削除時に `TemplateDoesNotExist` エラーが発生する問題を修正しました。
- 変更履歴（AppLog）の「対象」列が、一部のマスタデータ（スタッフタグ、クライアントタグ等）において日本語名ではなくモデル名（StaffTag等）で表示されていた問題を修正しました。
    - テンプレートの表示ロジックに不足していたマスタ定義を追加し、フォールバック時もモデルの `verbose_name` を自動取得するように改善しました。

### Changed
- `Staff` モデルに `tags` (ManyToManyField) を追加しました。
- 会社情報の「会社一覧（管理者用）」テーブルにおいて、現在選択中の会社の操作列に「選択中」ボタンを表示する代わりに、ハイフン（-）を表示するように変更しました。

## 2026-01-25

### Changed
- HOME画面の抵触日カードにサブアイコンを追加しました。
    - 事業所抵触日期限にはビルアイコン（`bi-building-fill`）を、個人抵触日期限にはスタッフアイコン（`bi-person-fill`）をそれぞれ設定しました。
- HOME画面の「業務サマリ」セクションの表示を4列に変更しました。
- HOME画面の「登録状況」セクションの誤った変更を元に戻しました。
- マイプロフィール画面（`/profile/`）の登録状況表示の文字サイズを調整しました。
    - stats-descriptionの文字サイズを標準的な大きさに変更しました。
    - stats-labelの文字サイズをstats-numberと同じ大きさに変更しました。
- マイプロフィール画面（`/profile/`）の登録状況表示をHOME画面の登録状況と同様のデザインに統一しました。
    - 各登録項目を四角いカード形式で表示し、薄い背景色を適用しました。
    - マウスオーバー時にカードが浮き上がるようなアニメーションを追加しました。
    - アイコンのサイズをHOME画面の登録状況と合わせ、視認性を向上させました。
- 問い合わせ（`StaffInquiry`）機能を修正しました。
    - `StaffInquiry`モデルから`content`フィールドを削除し、最初のメッセージは`StaffInquiryMessage`として保存するように変更しました。
    - 問い合わせ詳細画面の上部にあった「内容」欄を削除しました。
    - 完了済みの問い合わせには、スタッフはメッセージを投稿できないようにロジックを修正しました（会社側は投稿可能です）。
    - 「完了にする」ボタンに確認ダイアログを追加し、誤操作を防止するようにしました。
    - 問い合わせ一覧画面の表示を改善しました。
        - スタッフ向けに未読メッセージバッジを追加しました。
        - 会社向けに未回答ステータスを追加しました。
    - 問い合わせ一覧画面にステータスフィルタ機能を追加しました。
    - 問い合わせ一覧画面のフィルタデザインをスタッフ一覧画面と統一しました。

## 2026-01-24

### Changed
- HOME画面の「業務サマリ」と「登録状況」の表示順とリンクの挙動を改善しました。
    - 「業務サマリ」の項目順をユーザーの優先度に合わせて並び替えました（スタッフ連絡予定→スタッフ申請未承認→スタッフプロフィール申請未承認→クライアント連絡予定→クライアント申請未承認）。
    - 「登録状況」の項目順をスタッフ関連を先に、クライアント関連を後に並び替えました（スタッフ登録数→スタッフ接続承認済み→スタッフ契約登録数...）。
    - 「登録状況」のリンクに、「業務サマリ」と同様のホバーエフェクト（マウスオーバーでふわっと浮き上がるアニメーション）を追加し、クリック可能であることを直感的に分かりやすくしました。
    - 「登録状況」の契約数カウント（スタッフ・クライアント）について、本日以降に有効な契約のみを集計するように変更しました。
- 問い合わせ・ご連絡詳細画面の「完了にする」ボタンの配置とデザインを変更しました。
    - ボタンを画面下部の左側（投稿・戻るボタンの並び）に移動しました。
    - ボタンの色を黒（`btn-dark`）に変更し、完了（受付終了）アクションであることを明確にしました。

## 2026-01-23

### Changed
- スタッフ詳細画面の連絡履歴と連絡予定を統合しました。
    - 連絡予定を連絡履歴カード内に一緒に表示するようにし、予定アイテムには背景色（薄黄色）をつけ、アラームアイコン（<i class="bi bi-alarm"></i>）を表示して識別しやすくしました。
    - これに伴い、独立していた連絡予定カードを削除しました。
- スタッフ一覧画面の表示を改善しました。
    - 直近の連絡予定があるスタッフの社員番号横にアラームアイコン（<i class="bi bi-alarm"></i>）を表示するようにしました。
    - 連絡予定専用のカラム（日付と内容）を削除し、一覧性を向上させました。
- 連絡予定詳細画面に「連絡履歴として登録」カードを追加しました。
    - 予定の内容をコピーした状態で直接履歴を登録できるようになり、登録後は元の予定が自動的に削除されるようにしました。
- クライアント管理に「連絡予定」機能を追加しました。
    - スタッフ管理と同様に、連絡予定の登録・管理が可能になりました。
    - クライアント詳細画面で、連絡履歴と予定を統合して表示するようにしました。
    - 連絡予定詳細画面から、直接連絡履歴として登録して予定を完了できるようになりました。
- 連絡予定詳細画面（スタッフ・クライアント）に「メール送信（履歴登録・予定完了）」カードを追加しました。
    - 宛先の自動設定（スタッフ、またはクライアント担当者）や、送信時に自動で連絡履歴として登録し、予定を完了（削除）する機能。
    - 宛先が登録されていない場合はカードを非表示にする制御。
- スタッフおよびクライアントの連絡予定のサンプルデータ（2027年分 各5件）を追加しました。
    - 初期セットアップ時に自動的に読み込まれるよう設定。

### Fixed
- スタッフ一覧画面（`/staff/`）で発生していた `UnboundLocalError`（`timezone` 変数の参照エラー）を修正しました。
    - 関数内部で `timezone` を再インポートしていたため、スコープの問題で参照エラーが発生していました。


## 2026-01-17

### Refactored
- クリップボードへのコピー機能（`copy-to-clipboard.js`）および関連するスタイルを、各ページのテンプレートから共通のベーステンプレート（`_base.html`）に移動しました。
    - これにより、会社詳細画面、クライアント詳細画面、スタッフ詳細画面、その他の画面間での動作と見た目の不整合を解消し、保守性を向上させました。
    - 会社詳細画面で「コピーしました！」メッセージが表示されない問題を修正しました。
    - AIチェック画面（`templates/contract/ai_check_base.html`）における関数名の競合を解消するため、ローカル関数を `copyContractText` にリネームしました。
    - コピー成功時に、アイコンが一時的にチェックマーク（`bi-check`）に変化し、視覚的なフィードバックを提供するように改善しました。


### Changed
- 問い合わせ・ご連絡機能の名称およびラベルを改善しました。
    - メニュー名を「問い合わせ」から「問い合わせ・ご連絡」に変更しました。
    - 一覧・詳細・登録画面のタイトルを「問い合わせ・ご連絡」を含む名称に変更しました。
    - 画面上の項目名「問い合わせユーザ」を「スタッフ」に変更しました。
    - 画面上の項目名「問い合わせ先」「宛先クライアント」を「あて先企業」に変更しました。
    - 成功メッセージなどの文言を改善しました。
    - モデルの `verbose_name` を「スタッフ問い合わせ・ご連絡」に変更しました。
    - 問い合わせ（StaffInquiry）およびメッセージ（StaffInquiryMessage）にファイル添付機能を追加しました。
        - 会社側のユーザー（管理者・担当者）が新規メッセージ作成時や返信時にファイルを添付できるようにしました。
        - スタッフ側の画面では、添付ファイルの閲覧のみ可能とし、アップロードは制限しました。
        - 添付ファイルの表示をボタン形式からリンク形式に変更し、ファイル名とサイズを表示するようにUIを改善しました。

### Added
- スタッフ一覧画面に「社員登録状況一覧」モードを追加しました。
    - 社員番号があるスタッフのみを抽出し、マイナンバー、銀行情報、給与関連情報の登録状況をアイコンで一覧確認できる機能です。
    - このモードでは、個人情報保護と一覧性向上のため、住所と年齢の表示を非表示にしています。
    - 「その他検索」メニューから「社員登録状況一覧」を選択することでアクセス可能です。

## 2026-01-14

### Added
- メニューマスタのアイコン色指定に、HTML5のカラーピッカー機能を導入しました。
    - アイコンスタイル（`icon_style`）フィールドに連動したカラーピッカーを追加し、直感的に色を選択できるようになりました。
    - 管理画面の一覧にアイコンのプレビュー列を追加し、設定された色とアイコンが即座に確認できるように改善しました。
- `Menu`モデルおよび`ColorPickerWidget`に関する単体テストを新規・追加または修正し、品質を確保しました。

### Changed
- メニューマスタの管理画面一覧（`/admin/settings/menu/`）に「必要な権限」列を追加し、各メニュー項目に必要な権限を直接確認できるように改善しました。

## 2026-01-10

### Added
- スタッフ（派遣労働者）からの「問い合わせ」機能を追加しました。
    - 承認済みの接続クライアント（派遣先）を選択して、件名と内容を送信できる機能です。
    - 問い合わせ一覧、新規登録、詳細表示機能を実装しました。
        - 問い合わせが1件もない場合は、一覧画面から自動的に新規登録画面へ遷移する仕様にしました。
        - 詳細画面から、スタッフと担当者の間でチャット形式のメッセージ（`StaffInquiryMessage`）をやり取りできる機能を追加しました。
        - 自分のメッセージを薄緑色、相手のメッセージを薄灰色で表示し、左右に寄せる「LINE風」のチャットレイアウトを採用しました。
        - 担当者・管理者の返信時に「非表示（社内限定）」設定を行えるようにしました。
        - 問い合わせ詳細のメッセージに立体的な影をつけ、視認性を向上させました。
        - 問い合わせ一覧の列順を調整（送信日時、問い合わせユーザ、問い合わせ先、件名）しました。
    - 送信時および返信時に、接続承認状態を再検証するセキュリティチェックを追加しました。
    - 送信された問い合わせおよびメッセージは `AppLog` に記録され、変更履歴として確認可能です。
    - メニューからのアクセス先を `/staff/inquiry/` に統一し、URLの不整合を修正しました。
- クライアント契約（労働者派遣個別契約書）のAIチェック用に、専用のプロンプトテンプレートを生成AI設定（`GEMINI_PROMPT_TEMPLATE_CLIENT`）に追加しました。
- サンプル株式会社（自社）への問い合わせ機能のデモンストレーション用として、10件の問い合わせとそれぞれ5件ずつのやり取りを含むサンプルデータ（`staff_inquiry.json`, `staff_inquiry_message.json`）を追加しました。初期化時に自動的に読み込まれます。

### Changed
- スタートページ（`/start/`）の「サンプルデータ削除」ボタンの色を、視覚的な一貫性のため「初期セットアップ」ボタンと同じ「警告（黄色）」に変更しました。
- AIチェック機能（スタッフ・クライアント・アサインメント）のHTMLテンプレートとバックエンド処理を共通化し、保守性を向上させました（`ai_check_base.html` および `run_ai_check` ヘルパーの導入）。
- 会社基本情報（自社情報）に「丸印」および「角印」の画像登録機能を追加しました。
- 画像アップロード時に Cropper.js を使用して、任意の範囲を 600x600 px の正方形に切り抜いて登録・変更できる機能を追加しました。
- 登録された印章画像は会社詳細画面で確認および削除が可能です。

## 2025-12-31

### Added
- 「時間丸めマスタ」を「勤怠打刻マスタ（TimePunch）」にリネームし、関連するすべてのファイル名とコード参照を更新しました。
- 契約モデル（ClientContract, StaffContract）の `time_rounding` フィールドを `time_punch` にリネームしました。
- マスタ管理、契約入力画面、詳細画面におけるラベルを「時間丸め」から「勤怠打刻」に更新しました。

### Changed
- 内部的な時間計算ロジック（`apply_time_rounding` 関数等）および定数については、実態に合わせて「丸め（rounding）」の用語を維持するように調整しました。
- 企業情報取得API（gBizINFO）と住所取得API（ZipCloud）において、APIリクエスト結果を`ApiCache`モデルにキャッシュするように修正しました。これにより、同じリクエストに対するAPI呼び出し回数を削減し、パフォーマンスを向上させました。
- キャッシュの有効期間はパラメータ `API_CACHE_VALIDITY_PERIOD` (デフォルト: 86400秒) で設定可能です。

### Added
- APIヘルパーのキャッシュ動作を検証するためのテストコード (`apps/api/tests/test_helpers_cache.py`) を追加しました。

## 2025-12-29

### Added
- スタッフ向けタイムカード登録について、ステータスが「確認済み（契約済み）」の契約のみを対象とするよう制限を追加しました。未確認の契約は一覧に表示されず、URLから直接アクセスした場合も制限されます。
- スタッフ向けタイムカード登録画面（契約選択、カレンダー入力）へのアクセス時に、未同意の重要書類がある場合、同意画面へ自動的にリダイレクトする機能を追加しました。

### Changed
- スタッフの同意確認画面（`/connect/staff/<pk>/agree/`）のカードタイトルを「同意確認」から「{会社名} - 同意確認」に変更し、どの会社に対する同意であるかを明確にしました。

## 2025-12-24

### Added
- スタッフ契約延長確認画面（`/contract/staff/expire_list/`）に年月指定機能を追加しました。HTML5の`type="month"`入力フィールドを使用し、契約検索画面と同じスタイルで年月を指定できます。指定した年月の1日を基準日として割当期間内のアサインメントを表示します。デフォルトは本日の年月です。

## 2025-12-20

### Changed
- ログイン履歴（`/accounts/profile/`）において、ログイン成功（緑：`bg-success`）とログイン失敗（赤：`bg-danger`）をバッジの色で識別できるように変更しました。

## 2025-10-05

### Fixed
- クライアント契約確認一覧画面で、契約ステータスが「発行済み」または「確認済み」の場合に「確認」「未確認に戻す」ボタンが表示されない不具合を修正しました。テンプレートで参照しているステータスコードが誤っていたため、正しい値に修正しました。

## 2025-08-30

### Refactored
- スタッフの顔写真パス生成ロジックを、動的なパラメータ参照から`MEDIA_ROOT`を基準とした固定パス形式にリファクタリングしました。これにより、設定の依存性を減らし、コードの堅牢性を向上させました。

### Removed
- 上記のリファクタリングに伴い、不要となった`STAFF_FACE_PATH`パラメータをサンプルデータ (`_sample_data/parameters.json`) から削除しました。

## 2025-08-25

### Refactored
- スタッフの外国籍情報管理機能を `staff` アプリケーションから `profile` アプリケーションへ移行しました。
- これにより、ユーザー自身がプロフィールとして外国籍情報を管理できるようになりました。
- 関連するモデル、フォーム、ビュー、URL、テンプレート、管理サイト登録、およびメニュー設定を更新しました。

### Added
- ユーザーが自身の外国籍情報を登録・更新し、スタッフがその内容を承認・却下するリクエスト/承認ワークフローを追加しました。
- ユーザーが提出した外国籍情報のリクエストをスタッフが確認・処理するためのビューとテンプレートを追加しました。
- 関連する権限設定とログ記録を強化しました。

### Removed
- `apps/connect/admin.py` および `apps/profile/admin.py` を削除しました。管理サイトでの登録は不要になりました。
- `apps/master/migrations/0012_add_international_profile_to_menu.py` を削除しました。メニューへの追加は `_sample_data/menus.json` で管理されるようになりました。

## 2025-08-25

### Added
- スタッフの外国籍情報を管理する機能を追加しました。
- 在留カード番号、在留資格、在留期間などの情報を登録・編集・削除できます。
- 上記に伴い、関連するモデル、ビュー、フォーム、URL、テンプレート、サンプルデータを追加しました。

### Changed
- スタッフ詳細画面のUIを改善し、「マイナンバー」と「外国籍情報」へのリンクをドロップダウンメニューにまとめ、アクセスしやすくしました。
- スタッフ一覧画面に外国籍情報が登録されている場合にアイコンが表示されるようにしました。
- クライアント一覧画面およびスタッフ一覧画面のアイコン表示位置を調整し、視認性を向上させました。

## 2025-08-21

### Changed
- 「振込先銀行」を「会社銀行」に名称変更しました。これに伴い、関連するすべてのファイル（モデル、ビュー、フォーム、テンプレート、テスト、ドキュメント）を更新しました。

All notable changes to this project will be documented in this file.

The format is based on [Keep a Changelog](https://keepachangelog.com/en/1.0.0/),
and this project adheres to [Semantic Versioning](https://semver.org/spec/v2.0.0.html).

## 2025-08-21

### Added
- スタッフ情報に「雇用形態」(`employment_type`) フィールドを追加しました。
- これに伴い、関連するフォーム、ビュー、テンプレートを更新し、一覧画面でのフィルタリング機能と、詳細・編集画面での表示・入力機能を追加しました。
- 雇用形態の選択肢を管理するためのドロップダウン設定とサンプルデータを追加しました。

### Changed
- `apps/staff` にて、`StaffMyNumberRecord` モデルを `StaffMynumber` に名称変更し、関連するすべてのファイル（フォーム、ビュー、テンプレート）を更新しました。これは、命名規則の統一性を高めるためのリファクタリングです。
- `StaffMynumber` モデルを `StaffProfileMynumber` に名称変更し、関連するすべてのファイル（フォーム、ビュー、テスト、ドキュメント）を更新しました。これは、プロファイル関連のモデルであることをより明確にするためのリファクタリングです。

## 2025-08-19

### Added
- ヘッダーにウィンドウのブレークポイントと幅を表示する機能を追加しました。

## 2025-08-19

### Changed
- クライアントおよびスタッフの一覧画面と詳細画面に、承認済み接続ユーザーがいる場合にアイコンを表示するようにしました。

## 2025-08-19

### Changed
- プロフィール詳細画面の資格とスキルの表示を、よりコンパクトなバッジ形式にリファクタリングしました。
- 資格とスキルの一覧へのリンクを、正しい`profile`名前空間を指すように更新しました。
- 各セクションに、一覧ページへ遷移するためのボタンを追加しました。

## 2025-08-19

### Added
- スタッフのプロフィールに、保有資格とスキルを管理する機能を追加しました。
- 上記に伴い、関連するモデル、ビュー、フォーム、URL、テンプレート、テストを追加しました。

### Changed
- プロフィール詳細画面で、そのスタッフが保有する資格とスキルの一覧を表示するようにしました。

## 2025-08-19

### Changed
- 電話番号入力フィールドのバリデーションを強化し、半角数字とハイフンのみを許可するようにしました。
- 電話番号入力フィールドに`inputmode`, `pattern`, `style`, `autocomplete`属性を追加し、入力補助を強化しました。
- プロフィールフォームの住所関連のラベルをより明確な表記に変更し、レイアウトを調整しました。

### Added
- 電話番号フィールドの全角数字入力に関するテストケースをクライアント、スタッフ、プロフィールフォームに追加しました。

## 2025-08-19

### Changed
- カナ入力フィールドのバリデーションを強化し、ひらがな入力時に自動で全角カタカナに変換するようにしました。
- プロフィールフォームの氏名および氏名（カナ）のラベルをより明確な表記に変更しました。

### Added
- カナ入力の自動変換に関するテストケースをクライアント、スタッフ、プロフィールフォームに追加しました。

## 2025-08-19

### Changed
- スタッフプロファイルフォーム (`StaffProfileForm`) において、以下のフィールドを必須項目としました: 生年月日、性別、郵便番号、住所1、住所2、電話番号。

### Added
- スタッフプロファイルフォームの必須フィールドに関するテストケースを追加しました。

## 2025-08-19

### Changed
- クライアント部署フォームとクライアント担当者フォームに`help_tags`をロードする設定を追加しました。

## 2025-08-18

### Changed
- 電話番号入力フィールドのバリデーションを強化し、数字とハイフンのみを許可するようにしました。
- カタカナ入力フィールドのバリデーションを強化し、半角カタカナも許可するようにしました。
- 各フォームの電話番号入力フィールドにヘルプテキストを追加しました。

### Added
- 電話番号およびカタカナ入力のバリデーションに関するテストケースを追加しました。

## 2025-08-18

### Changed
- マスター管理画面（銀行、銀行支店）のレイアウトを調整し、コンテナのネストを減らしてシンプルにしました。
- 各画面のボタン配置を `d-flex justify-content-start` を使用して左寄せに統一しました。

## 2025-08-18

### Changed
- プロファイル管理画面のレイアウトを調整し、コンテナのネストを減らしてシンプルにしました。
- 各画面のボタン配置を `d-flex justify-content-start` を使用して左寄せに統一しました。

### Added
- 厚生労働省の職業分類に対応するサンプルデータ (`dropdowns_jobs_kourou.json`) を追加しました。

## 2025-08-18

### Changed
- ユーザーモデル (`MyUser`) とスタッフプロファイル (`StaffProfile`) の姓名を同期するように変更しました。
- ユーザー情報 (`MyUser`) の姓名が更新された際、関連するスタッフプロファイル (`StaffProfile`) の姓名も自動的に更新されます。
- プロファイルがまだ存在しない場合、プロファイル作成画面でユーザーの姓名が初期値として設定されるようになりました。

### Added
- 上記の姓名同期機能に関するテストケースを追加しました。

## 2025-08-17

### Changed
- `StaffProfile` モデルを更新し、Djangoの `User` モデルと姓名（`first_name`, `last_name`）が自動で同期するようにしました。プロファイル作成時にはユーザー情報から名前が設定され、プロファイル更新時にはユーザー情報も同時に更新されます。

## 2025-08-16

### Added
- スタッフ接続が承認された際に、そのユーザーに対してプロファイル (`StaffProfile`) とマイナンバー (`StaffProfileMynumber`) の表示、追加、変更、削除権限を自動的に付与する機能を追加しました。
- 上記の権限付与ロジックに関するテストケースを追加しました。
- プロファイル管理機能の各ビューに権限制御を追加しました。

### Refactored
- `apps/connect` および `apps/profile` アプリケーションのテスト構造を、単一の `tests.py` ファイルから `tests` ディレクトリを使用する形式にリファクタリングしました。
- プロファイル管理機能の権限制御を、ビュー内の手動チェックから `@permission_required` デコレータを使用する方式に変更しました。

---
## 2025-08-16

### Added
- プロファイル管理機能にマイナンバー（個人番号）の登録・編集・削除機能を追加しました。
- `StaffProfileMynumber` モデル、フォーム、ビュー、テンプレート、テストコードを追加しました。
- `python-stdnum` ライブラリを利用したマイナンバーの妥当性チェック機能を追加しました。
- サイドバーに「マイナンバー」メニューを追加しました。

### Removed
- `_sample_data/profile_menu.json` を削除し、`_sample_data/menus.json` に統合しました。

---
## 2025-08-16

### Added
- ユーザープロファイル機能 (`profile`) を追加しました。
- `profile` アプリケーションを `INSTALLED_APPS` と `urls.py` に登録しました。
- テンプレート内でモデルの選択肢（choices）の表示名を取得するための `lookup` フィルタを `help_tags.py` に追加しました。
- プロファイルメニュー用のサンプルデータ (`profile_menu.json`) を追加しました。

---
## 2025-08-16

### Changed
- 振込先銀行マスタの銀行コードと支店コードを必須項目に変更しました。関連する入力フォームのヘルプテキストとバリデーションも更新しました。

---
## 2025-08-16

### Added
- 接続管理機能 (`connect`) とマスター管理機能 (`master`) に関するドキュメントを更新しました。

## 2025-08-16

### Changed
- 管理者権限を持つユーザーが、すべてのスタッフおよびクライアントの接続情報を閲覧できるよう変更しました。

### Added
- スタッフおよびクライアントの接続情報一覧に、メールアドレスを表示するよう変更しました。

## 2025-08-14

### Added
- 銀行および銀行支店のマスターデータを一元的に管理できる統合画面 (`bank_management`) を追加しました。この画面では、銀行と銀行支店の一覧表示、検索、フィルタリング、および選択された銀行の支店表示が可能です。
- 銀行情報の表示に使用する共通テンプレート (`_bank_info.html`, `_bank_info_simple.html`) を追加しました。
- 銀行および銀行支店のマスターデータ管理機能（CRUD操作、一覧表示、詳細表示、変更履歴）を追加しました。
- これに伴い、`Bank` および `BankBranch` モデル、関連するフォーム、ビュー、URL、テンプレート、サンプルデータ、テストファイルを追加しました。
- スタッフ詳細画面に、アカウント接続リクエストの状態を管理するためのトグルスイッチを追加しました。
- アカウント接続関連の操作がスタッフの変更履歴に詳細に記録されるようにログ記録を強化しました。
- アカウント接続機能における権限管理を強化しました。接続リクエストの作成時、承認時、およびアカウントの作成・更新時に、関連するユーザーに適切な権限を自動的に付与する機能を追加しました。
- この権限付与ロジックを管理するための新しいユーティリティファイル `apps/connect/utils.py` を追加しました。
- アカウント接続機能における権限付与のテストケースを追加しました。
- スタッフがシステムにログインするためのアカウント接続招待機能を追加しました。
- この機能のために、新しいアプリケーション `apps/connect` を作成しました。
- スタッフ詳細画面に、メールアドレスが登録されている場合に「接続招待」ボタンを表示するようにしました。
- パスワード検証機能に関するテストを追加しました。
- ナビゲーションメニューの項目ごとに表示権限を設定できる機能を追加しました。これにより、ユーザーの権限に応じて表示されるメニューを動的に制御できます。
- スタッフおよびクライアント情報更新時に、変更があった場合のみデータベースを更新し、変更履歴を記録する機能を追加しました。
- 変更がない場合は、その旨をメッセージで表示するようにしました。
- スタッフ削除時に成功メッセージを表示するようにしました。
- 銀行および銀行支店の統合管理画面のすべての変更履歴を表示するページ (`bank_management/history/`) を追加しました。
- 共通の変更履歴リストにページネーション機能を追加しました。
- クライアント契約およびスタッフ契約の変更履歴を詳細に表示する機能を追加しました。
- これに伴い、`client_contract_change_history_list` および `staff_contract_change_history_list` ビューと、共通テンプレート `templates/contract/contract_change_history_list.html` を追加しました。
- 会社関連の変更履歴表示を `templates/company/company_change_history_list.html` に移行しました。
- クライアント担当者に対するアカウント接続招待機能を追加しました。
- クライアント担当者の詳細画面 (`client_user_detail`) を追加し、そこから接続リクエストの管理（作成、削除）と変更履歴の表示ができるようにしました。
- クライアント接続リクエストのリスト表示、承認、非承認を行うためのビュー (`connect_client_list`, `connect_client_approve`, `connect_client_unapprove`) を追加しました。
- クライアント接続に関連する権限を付与するためのユーティリティ関数 (`grant_client_connect_permissions` など) を追加しました。
- アカウント作成/更新時に権限を付与するためのシグナル (`apps/accounts/signals.py`) を追加しました。

### Changed
- 銀行および銀行支店の個別のリスト、詳細画面を廃止し、すべての管理操作を統合された `bank_management` 画面から行えるようにしました。
- 銀行および銀行支店の作成、更新、削除後のリダイレクト先を統合管理画面に変更しました。
- マスター管理画面の構成に、新しい銀行および銀行支店のマスター設定を追加しました。
- スタッフ詳細画面で、スタッフのアカウント接続状態を視覚的に確認し、簡単に切り替えられるようにUIを改善しました。
- 変更履歴リストに「接続」のバッジを追加し、接続関連のログを識別しやすくしました。
- ログイン画面とプロファイル編集画面において、入力エラーがある場合に該当フィールドをハイライトし、エラーメッセージを分かりやすく表示するように改善しました。
- 認証関連画面のエラーメッセージのスタイルを、より警告が明確に伝わるデザインに変更しました。
- 利用規約ページのURLを `/terms-of-service/` から `/terms/` へ変更しました。
- メニュー表示のロジックを更新し、権限設定を反映するようにしました。
- 契約一覧画面の契約金額を右寄せで表示するように修正しました。
- 銀行および銀行支店のマスターデータ一覧の表示順序を、銀行コード、銀行名、支店コード、支店名で統一しました。
- 銀行支店作成/更新フォームにおいて、特定の銀行の支店を作成する際に、その銀行の情報がフォーム上部に表示されるように改善しました。
- 銀行および銀行支店の更新ボタンのスタイルを統一しました。
- 銀行および銀行支店の作成、更新、削除画面の「キャンセル」ボタンや「戻る」ボタンのリンク先を統合管理画面に統一しました。
- 銀行および銀行支店の統合管理画面の変更履歴表示件数を10件から5件に削減しました。
- マスター管理画面の変更履歴表示件数を10件から5件に削減しました。
- 変更履歴リストに「種別」カラムを追加し、各ログのモデル名に応じたバッジを表示するようにしました。
- 変更履歴リストのカードヘッダーにタイトルを表示できるようにしました。
- `object_repr` の表示文字数を40から60に増やしました。
- 変更履歴リストのフッターにある「すべて表示」リンクの表示条件を、`change_logs_count` が0より大きく、かつ `history_url` が存在する場合に限定しました。
- 変更履歴リストに「戻る」ボタンを追加し、`back_url` が渡された場合に表示されるようにしました。
- クライアント契約およびスタッフ契約の詳細画面から、変更履歴の詳細ページへのリンクが正しく生成されるように変更しました。
- 変更履歴リストにおいて、詳細画面では `object_repr` を切り詰めて表示し、変更履歴リスト画面ではすべて表示するように、表示内容を切り替えられるようにしました。
- 共通の変更履歴リスト (`common/_change_history_list.html`) のページネーションロジックを改善し、より使いやすくしました。
- 接続機能のトップページ (`connect/index.html`) で、スタッフとクライアントそれぞれの接続リクエストの統計情報とリストへのリンクを表示するようにUIを改善しました。
- クライアント担当者一覧で、担当者名が詳細ページへのリンクになるように変更しました。
- 銀行管理画面 (`bank_management.html`) の更新ボタンと削除ボタンのHTML構造を修正しました。

### Refactored
- 銀行および銀行支店に関するURL、ビュー、テンプレートを大幅に整理・統合しました。
- 銀行および銀行支店の変更履歴表示を共通テンプレート (`_bank_change_history_list.html`) に集約しました。
- 変更履歴表示用のテンプレートを `templates/common/_change_history_list.html` に共通化しました。
- すべての変更履歴表示を `templates/common/_change_history_list.html` に完全に共通化しました。
- 各テンプレートから変更履歴表示のロジックを削除し、共通テンプレートにコンテキスト変数を渡すように変更しました。
- クライアント、会社、契約関連の変更履歴表示を `common/_change_history_list.html` に共通化しました。
- 会社関連の変更履歴表示を共通テンプレート (`common/_change_history_list.html`) に移行しました。

### Removed
- 銀行および銀行支店の個別のリスト、詳細画面のテンプレート (`bank_list.html`, `bank_detail.html`, `bank_branch_list.html`, `bank_branch_detail.html`) を削除しました。
- `templates/master/_bank_change_history_list.html` および `templates/master/_change_history_list.html` を削除しました。
- `templates/company/change_history_list.html` を削除しました。

## 2025-08-13

### Changed
- **UI/UX改善**:
    - ユーザー操作（作成、更新、削除）後に成功メッセージを表示するようにしました。
    - Djangoメッセージの表示ロジックを `_base.html` に一元化し、各詳細テンプレートから削除しました。

## 2025-08-13

### Added
- **契約管理**:
    - クライアント契約およびスタッフ契約のサンプルデータを追加しました。
- **依存関係**:
    - 数値のカンマ区切り表示のために `django.contrib.humanize` を追加しました。

### Changed
- **契約管理**:
    - 契約金額の表示にカンマ区切りを追加し、視認性を向上させました。

## 2025-08-13

### Changed
- **リファクタリング**:
    - ユーザー管理および認証機能を担当していた `apps/system/useradmin` アプリケーションを、より責務が明確になるよう `apps/accounts` アプリケーションとして独立させました。
    - これに伴い、`AUTH_USER_MODEL` の設定、関連するURL、ビュー、テンプレート、テストコード、ドキュメントなど、プロジェクト全体にわたる参照を更新しました。

## 2025-08-13

### Added
- **クライアント管理**:
    - クライアント担当者一覧画面および詳細画面から、担当者宛に直接メールを送信する機能を追加しました。
- **セキュリティ**:
    - ログインおよびログアウトの監査ログに、操作元のIPアドレスを記録するようにしました。
- **マスター管理**:
    - 支払条件マスターの一覧画面に、各支払条件が現在クライアント情報および契約情報で何件使用されているかを示す「使用件数」」を追加しました。

### Changed
- **マスター管理**:
    - アプリケーション全体で用語を統一するため、「支払サイト」を「支払条件」に名称変更しました。これに伴い、関連するモデル、フォーム、ビュー、テンプレートの表記をすべて更新しました。
- **スタッフ管理**:
    - スタッフへのメール送信機能を改善し、送信内容は必ず「対応履歴」に記録されるように仕様を変更しました。

### Removed
- **契約管理**:
    - 契約情報（クライアント・スタッフ）のモデルから、手動入力フィールドであった「支払条件」(`payment_terms`)を削除しました。今後はマスター設定された「支払条件」に一本化されます。

## 2025-08-11

### Added
- **マスター管理**:
    - 請求関連のマスターデータとして、「支払サイト」および「振込元銀行」の管理機能（CRUD）を追加しました。
    - 上記機能に関するテストコードおよびサンプルデータを追加しました。

### Changed
- **UI/UX改善**:
    - マスター管理の一覧画面を、「スタッフ関連」や「請求関連」といったカテゴリ別にグループ化して表示するように改善し、視認性を向上させました。
- **リファクタリング**:
    - マスター管理機能（資格、スキル、支払サイト、振込元銀行）の変更履歴表示を共通のテンプレートに統合し、コードの重複を削減しました。
    - ヘルプアイコンの表示を独自のテンプレートタグ (`my_help_icon`, `my_help_preset`) に共通化しました。これにより、コードの保守性が向上し、ヘルプテキストを一元管理できるようになりました。

## 2025-08-10

### Added
- **契約管理**:
    - クライアント詳細画面およびスタッフ詳細画面に、関連する契約情報の一覧（最新5件）を表示し、契約一覧へ遷移できるようにしました。
    - 契約一覧画面に、特定のクライアントまたはスタッフでフィルタリングする機能を追加しました。

### Changed
- **スタッフ管理**:
    - スタッフの退職日を設定する際、その日以降に終了する有効な契約が存在する場合はエラーを表示し、安易に退職させられないように変更しました。

# 変更履歴

## 2025-08-09

### Changed
- **UI/UX改善**:
    - クライアントの組織、担当者、マスターデータの削除確認画面の表示を調整しました。
    - クライアント詳細画面の表示を調整しました。
- **設定・メニュー管理**:
    - ドロップダウンとメニューのテンプレートタグをリファクタリングし、関連する設定モデルを更新しました。
    - これに伴い、クライアント、スタッフ、共通、ログ関連の多数のテンプレートファイルを更新し、UI/UXを改善しました。

### Removed
- **会社・クライアント管理**:
    - 会社情報およびクライアント情報からURLフィールドを削除しました。

### Changed
- **会社管理**:
    - 会社基本情報の編集画面における法人番号の妥当性チェックをクライアント編集画面のロジックと統一しました。
    - 会社アプリケーションのテストコードを修正し、URLフィールドの削除と法人番号バリデーションのテストを更新しました。
- **内部調整**:
    - マスターアプリケーションの内部ファイル (`apps.master.apps.py`, `apps.master.signals.py`) の調整を行いました。
    - クライアント詳細画面 (`templates/client/client_detail.html`) の表示調整を行いました。

## 2025-08-08

### Changed
- **対応履歴**:
    - スタッフおよびクライアントの対応履歴登録時に、対応日時を手動で設定できるよう変更しました。これにより、過去の履歴入力が容易になりました。
- **UI/UX改善**:
    - 各種画面のレイアウトを調整し、情報カードやボタンの配置を統一して、より一貫性のあるデザインにしました。
    - ファイル一覧、削除確認画面などのUIを改善し、使いやすさを向上させました。

## 2025-08-08

### Added
- **クライアント管理**:
    - クライアント情報に「基本契約締結日」フィールドを追加しました。

### Changed
- **ファイル管理**:
    - スタッフおよびクライアントのファイル管理機能を簡素化し、詳細表示・編集機能を削除しました。アップロードと削除のみの操作に統一し、UIを改善しました。
- **テスト**:
    - ファイル管理機能に関するテストを拡充し、アップロード、ダウンロード、削除の各操作を網羅するようにしました。

## 2025-08-08

### Added
- **マスター管理**:
    - 資格・技能マスタの変更履歴（ログ）を記録・表示する機能を追加しました。
    - 各マスタの一覧画面に最新の変更履歴5件を表示し、全履歴を確認できるページへのリンクを設置しました。

### Changed
- **テスト**:
    - `client`および`staff`アプリケーションのテストファイルを、各アプリ内の`tests`ディレクトリに移動し、構造を整理しました。
- **管理画面**:
    - `client`, `company`, `staff` モデルをDjangoの管理サイトから登録解除し、Webアプリケーション上での管理に統一しました。

## 2025-08-08

### Added
- **ファイル管理機能**:
    - スタッフ情報およびクライアント情報に、関連ファイル（契約書、議事録、画像等）を添付する機能を追加しました。
    - ファイルのアップロード、一覧表示、詳細確認、ダウンロード、削除が可能です。
    - ファイル操作（作成、更新、削除）は変更履歴に記録されます。
- **テスト**:
    - ファイル管理機能に関するテストケース（モデル、ビュー、フォーム）を追加しました。

### Changed
- **スタッフ管理**:
    - スタッフのスキル管理から「レベル」の概念を撤廃し、よりシンプルなスキル登録・管理機能に変更しました。
- **UI/UX改善**:
    - スタッフおよびクライアントの詳細画面に、添付ファイルの一覧（最新5件）を表示するようにしました。
    - 変更履歴の表示を改善し、どのデータ（基本情報、部署、ファイルなど）に対する操作かを明確にしました。
- **依存関係**:
    - ファイルストレージ管理のため、`django-storages`ライブラリを追加しました。

### Removed
- **スタッフ管理**:
    - スタッフスキルモデルから`level`フィールドを削除しました。

## 2025-08-08

### Changed
- **スタッフ管理**:
    - スタッフ保有資格一覧画面に点数表示列を追加しました。
    - スタッフ保有資格編集画面に点数入力フィールドを追加しました。

### Added
- **スタッフ管理**:
    - スタッフ保有資格モデルに点数フィールドを追加しました。
    - スタッフ保有資格のフォームに点数フィールドを追加しました。
    - スタッフ詳細画面の資格表示に点数を表示するようにしました。

### Changed
- **マスタ管理**:
    - 資格マスタ一覧と技能マスタ一覧に「戻る」ボタンを追加し、マスタ一覧ページへ遷移するようにしました。
    - 資格詳細画面および技能詳細画面から作成日時と更新日時を削除しました。
    - 資格編集画面および技能編集画面の説明フィールドをテキストエリアから1行入力に変更しました。
    - マスタ一覧画面からカテゴリ数と総件数の表示を削除しました。
    - マスタ一覧画面の操作列の「管理」ボタンを編集アイコンに変更しました。

## 2025-08-08

### Changed
- **管理画面**:
    - 会社および部署モデルを管理サイトから登録解除しました。

## 2025-08-08

### Changed
- **テスト**:
    - `apps/master/models.py`の`Qualification`および`Skill`モデルの`save`メソッドから`skip_validation`引数を削除しました。
    - `apps/staff/tests/test_staff_qualification.py`および`apps/staff/tests/test_staff_skill.py`のテストコードを修正し、`Qualification`および`Skill`モデルのインスタンス作成時に`skip_validation`引数を渡さないようにしました。
    - `apps/staff/tests/test_staff_qualification.py`および`apps/staff/tests/test_staff_skill.py`から、削除された詳細ビューのテストを削除しました。
    - `apps/staff/tests/test_staff_skill.py`から、`Skill`モデルの`required_level`属性削除に伴うテストを削除しました。
    - `apps/staff/tests/test_staff_qualification.py`および`apps/staff/tests/test_staff_skill.py`の`__str__`メソッドのテストの期待値を、階層構造を反映した新しい文字列形式に更新しました。

## 2025-08-08

### Added
- **スタッフ管理**:
    - 保有資格および保有技能の編集・削除機能を追加しました。

### Changed
- **UI/UX改善**:
    - スタッフ詳細画面の資格と技能の表示を、テーブル形式からバッジ形式に変更し、よりコンパクトで視認性の高いデザインにしました。
    - 各バッジの横に、保有資格・技能の一覧ページへのリンクを設置しました。
    - 保有資格一覧、保有技能一覧、保有資格の登録・編集・削除、保有技能の登録・編集・削除画面にスタッフ情報カードを表示するようにしました。
- **テスト**:
    - `staff`アプリケーションのテストコードにおいて、URLの逆引きを名前空間 `staff:` を使用するよう修正しました。
    - `Qualification`および`Skill`モデルのテストデータ作成時に、不要な引数を削除しました。
    - `apps/staff/views.py`で`StaffQualification`および`StaffSkill`モデルをインポートするように修正しました。

## 2025-08-08

### Added
- **マスター管理**:
    - 各マスターデータ（資格、スキルなど）の概要を一覧表示するインデックスページを追加しました。
    - インデックスページには、各マスターの名称、説明、登録件数を表示し、各管理ページへのリンクを設置しました。

### Changed
- **UI/UX改善**:
    - スタッフ詳細画面の資格・スキル表示エリアのレイアウトを調整し、項目名と内容が横並びになるように変更しました。

## 2025-08-08

### Added
- **スタッフ管理**:
    - スタッフ詳細画面に、そのスタッフが保有する資格とスキルを5件まで表示する機能を追加しました。
    - スタッフごとに保有資格を追加登録する機能を追加しました。
    - スタッフごとに保有スキルを追加登録する機能を追加しました。
    - スタッフの保有資格を一覧で確認できる画面を追加しました。
    - スタッフの保有スキルを一覧で確認できる画面を追加しました。

### Changed
- **UI/UX改善**:
    - スタッフ詳細画面のレイアウトを調整し、資格・スキル情報を分かりやすく表示するようにしました。
    - 資格マスタおよび技能マスタの一覧画面で、名称と説明欄の幅を調整し、視認性を向上させました。
- **テスト**:
    - `staff`アプリケーションのテストコードにおいて、URLの逆引きを名前空間 `staff:` を使用するよう修正しました。

## 2025-08-06

### Added
- **資格マスタ**:
    - 資格に階層構造（カテゴリと資格）を導入しました。
    - 資格カテゴリの作成機能を追加しました。
    - 資格カテゴリと資格を階層的に表示する一覧画面を実装しました。
    - 関連するモデル、フォーム、ビュー、テンプレート、管理画面、テストコード、サンプルデータを追加・修正しました。
- **管理画面**:
    - 資格マスタと技能マスタを管理画面から非表示にしました（Webインターフェースでの管理を優先）。

### Changed
- **技能マスタ一覧**:
    - 技能カテゴリとスキルを単一のテーブルで階層的に表示するようにUIを変更しました。
    - 関連するビューのデータ取得ロジックを修正しました。

## 2025-08-06

### Added
- **技能マスタ**:
    - 技能に階層構造（カテゴリとスキル）を導入しました。
    - 技能カテゴリの作成機能を追加しました。
    - 技能カテゴリとスキルを階層的に表示する一覧画面を実装しました。
    - 関連するモデル、フォーム、ビュー、テンプレート、管理画面、テストコード、サンプルデータを追加・修正しました。
- **ドキュメント**:
    - `.kiro/steering/tech.md`に開発時のヒントに関するセクションを追加しました。

### Changed
- **マスタ管理**:
    - 資格マスタから「発行機関」と「有効期間」フィールドを削除しました。
    - 技能マスタから「必要レベル」フィールドを削除しました。
    - 上記フィールドの削除に伴い、モデル、フォーム、ビュー、テンプレート、管理画面、テストコードを修正しました。

## 2025-08-06
- **機能改善**:
    - 変更履歴に項目名を表示するように修正しました。
- **UI/UX改善**:
    - 技能管理機能のHTMLを資格管理機能と統一し、デザインの一貫性を向上させました。

## 2025-08-06
- **機能追加**:
    - 資格・スキルを管理する「マスター管理」機能を追加しました。
    - スタッフに資格とスキルを紐付ける機能を追加しました。
    - 上記に伴い、関連する画面、URL、サンプルデータを追加・修正しました。
- **機能変更**:
    - クライアントの対応履歴登録時に、部署と担当者を選択できるよう変更しました。
    - クライアント関連画面で、クライアント情報カードを表示するようにしました。
    - スタッフ管理機能のURL名前空間を`staff:`に統一しました。
- **削除**:
    - クライアント部署モデルから不要な`email`フィールドを削除しました。

## 2025-08-04
- **テスト構造の改善**:
    - `apps/system/logs/tests.py`, `apps/system/settings/tests.py`, `apps/system/useradmin/tests.py` を削除し、各アプリケーションの `tests/` ディレクトリにテストファイルを再配置。
- **UI/UX改善**:
    - クライアント詳細画面の編集ボタンのスタイルを統一。
    - ホーム画面のカード背景色を調整。


## 2025-08-04
- **データ管理**:
    - クライアントの部署と担当者のサンプルデータを追加し、`load_sample_data.py` および関連スクリプトを更新。


## 2025-08-04
- **クライアント管理機能の強化**:
    - クライアントモデルに部署（`ClientDepartment`）と担当者（`ClientUser`）モデルを追加。
    - 各モデルのCRUD機能と関連するビュー、フォーム、URL、テンプレートを実装。
    - 部署に有効期間と重複チェック機能を追加。
    - クライアント詳細画面に部署と担当者の一覧を表示。
    - 変更履歴に部署と担当者の操作ログも表示されるように拡張。


## 2025-08-04
- **データ管理**:
    - サンプルデータに会社情報と部署情報を追加し、`load_sample_data.py` および関連スクリプトを更新。
    - `_sample_data/settings.json` を削除。
- **UI/UX改善**:
    - スタッフ一覧画面で、部署コードが設定されていない場合の表示を「-」に変更。


## 2025-08-04
- **スタッフ管理機能の強化**:
    - スタッフモデルに社員番号、入社日、退職日、所属部署コードのフィールドを追加。
    - 入社日と退職日の期間バリデーションを追加。
    - 所属部署を会社情報から取得し、選択肢として表示。
    - スタッフ詳細画面に雇用状況と所属部署名を表示。
    - スタッフ一覧画面に所属部署によるフィルタリング機能を追加。
- **UI/UX改善**:
    - 部署新規作成画面で部署一覧が表示されるように修正。


## 2025-08-04
- **UI/UX改善**:
    - 会社情報関連ページで部署一覧の表示を共通テンプレート `_department_list_table.html` に統一。


## 2025-08-04
- **バリデーション強化**:
    - 会社情報の法人番号に`stdnum`ライブラリを利用したバリデーションチェックを追加。
- **テストの追加**:
    - 法人番号のバリデーションに関するフォームテストを追加。


## 2025-08-04
- **セキュリティ強化**:
    - 会社情報および部署管理機能の各ビューに、Djangoの標準権限（`view_company`, `change_company`など）を適用。
    - 権限を持たないユーザーからのアクセスを制限し、403エラーを返すように設定。
- **テストの追加**:
    - 会社情報および部署管理機能に関する権限テストを追加し、権限を持つユーザーと持たないユーザーのアクセス制御が正しく機能することを確認。


## 2025-08-04 (作業中)
- **認証機能のリファクタリング (django-allauth)**:
    - `django-allauth` を全面的に採用し、メールアドレスベースの認証フロー（ユーザー登録、ログイン、パスワードリセット）を再構築。
    - サインアップ時に氏名の入力を必須とし、利用規約への同意を求めるように変更。
    - パスワードリセットの有効期限を24時間に延長。
    - 認証関連のメール送信時に、送信ログを記録するように`CustomAccountAdapter`を拡張。
    - 関連する設定、URL、テンプレート、テストを全面的に見直し・修正。


## 2025-08-04
- **会社・部署管理機能の改善**:
    - 部署モデルに部署コード、会計コード、表示順のフィールドを追加。
    - 部署一覧を会社詳細ページに統合し、独立した部署一覧ページを削除。
    - 部署の登録・編集・詳細画面に部署一覧を表示し、画面遷移を改善。
- **UI/UXの改善**:
    - 削除確認画面に警告アラートを追加し、誤操作を防止。
    - 各画面のボタンやフォームのレイアウトを調整し、一貫性を向上。
- **ドキュメントの更新**:
    - `README.md`、`product.md`、`structure.md`などの関連ドキュメントを更新。


## 2025-08-04
- **会社情報機能の強化**:
    - 会社詳細画面に部署一覧と変更履歴を表示。
    - 会社情報および部署情報の登録・編集・削除時にログを記録するように変更。
    - 外部API（gBizINFO, zipcloud）と連携し、法人番号からの情報取得および郵便番号からの住所検索機能を追加。
- **UI/UXの改善**:
    - 全体的なレイアウトを調整し、視認性を向上。
    - ボタンのスタイルを統一し、`btn-sm`を適用。
    - フォームのラベルと入力欄の配置を調整。
    - Tooltipを追加し、入力項目の説明を補足。
    - 削除ボタンのスタイルを`btn-dark`に統一。
- **その他**:
    - 部署モデルに住所、電話番号などのフィールドを追加。
    - 変更がない場合は更新しないように修正。


## 2025-08-04
- **部署管理機能の追加**: 会社情報に部署管理機能（CRUD）を追加しました。
- **関連ファイルの追加**: 部署管理機能に関するフォーム、URL、ビュー、テスト、テンプレートを追加・更新しました。


## 2025-08-03
- **テストの修正**: ModuleNotFoundErrorとAssertionErrorを修正し、プロジェクト全体のテストがすべてパスすることを確認。


## 2025-08-03
- **法人番号バリデーションの追加**: クライアントの法人番号フィールドにstdnumライブラリを使用したバリデーションを追加。
- **法人番号バリデーション用ユーティリティとテストの追加**: 法人番号バリデーション用のユーティリティ関数と単体テストを追加。
- **ドキュメント更新**: アプリケーションの主要ドキュメント（README.md, .gemini/GEMINI.md, .kiro/steering/structure.md, .kiro/steering/tech.md）を更新し、システムアプリケーションのリファクタリングと法人番号バリデーションの変更を反映。
- **依存関係の更新**: requirements.txtにpython-stdnumのバージョン指定を追加。


## 2025-08-03
- **システムアプリケーションのリファクタリング**: dropdowns、menu、parametersアプリをsettingsアプリに統合。
- **関連コードの更新**: 統合に伴い、関連するすべてのimport文と参照を更新。
- **ドキュメント更新**: 新しいアプリケーション構造を反映するようにドキュメントを更新。
- **旧アプリケーションの削除**: 古いdropdowns、menu、parametersアプリケーションを削除。


## 2025-08-03
- **データベースリセットスクリプトの最適化**: scriptsフォルダを_scriptsに変更、マイグレーション処理を簡潔化
- **commonアプリマイグレーション問題の根本解決**: 複雑なマイグレーション履歴をクリーンアップ、--fakeオプションを削除。
- **サンプルデータインポートスクリプトの改善**: 不親切な注意メッセージを削除、ユーザー体験を向上。
- **対話型コマンド問題の解決**: createsuperuserを適切に分離、スクリプトの責務を明確化。


## 2025-08-03
- **クライアント連絡履歴サンプルデータ追加**: 30件のサンプルデータを作成。
- **サンプルデータ管理ガイド作成**: データインポート/エクスポート手順を文書化。


## 2025-08-03
- **Django 5.2.4アップデート**: 5.2.1から5.2.4に更新。
- **requirements.txt更新**: pytestを追加、実際の環境と整合。
- **マイグレーション修正**: common_applogテーブル削除の問題を解決。
- **変更管理文書作成**: CHANGELOG.mdとDEPLOYMENT.mdを新規作成。