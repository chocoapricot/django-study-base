{% extends 'common/_base.html' %}
{% load favorite_tags %}

{% block extra_css %}
<style>
    .table-saturday,
    .table-saturday > td {
        background-color: #e6f2ff !important;
    }
    .table-sunday,
    .table-sunday > td {
        background-color: #ffe6e6 !important;
    }
    .text-saturday {
        color: #0066cc !important;
    }
    .text-sunday {
        color: #cc0000 !important;
    }
</style>
{% endblock %}

{% block content %}
<div class="content-box card bg-light mt-2 mb-4">
    <div class="card-header d-flex justify-content-between align-items-center">
        <div>
            勤怠打刻申請詳細
            <span class="text-muted">- {{ approval.staff }}{% favorite_star approval.staff %} ({{ approval.closing_date|date:"Y年m月" }})</span>
        </div>
        <div>
            {% if approval.status == '10' %}
                <span class="badge bg-secondary">{{ approval.get_status_display }}</span>
            {% elif approval.status == '20' %}
                <span class="badge bg-info">{{ approval.get_status_display }}</span>
            {% elif approval.status == '30' %}
                <span class="badge bg-success">{{ approval.get_status_display }}</span>
            {% elif approval.status == '40' %}
                <span class="badge bg-danger">{{ approval.get_status_display }}</span>
            {% endif %}
        </div>
    </div>
    <div class="card-body">
        <div class="row mb-3 align-items-center">
            <div class="col-sm-2 text-start text-sm-end"><strong>スタッフ</strong></div>
            <div class="col-sm-10">
                <a href="{% url 'staff:staff_detail' approval.staff.pk %}" target="_blank">
                    {{ approval.staff }} <i class="bi bi-box-arrow-up-right"></i>
                </a>
                {% favorite_star approval.staff %}
            </div>
        </div>
        <div class="row mb-3 align-items-center">
            <div class="col-sm-2 text-start text-sm-end"><strong>契約</strong></div>
            <div class="col-sm-10">
                <a href="{% url 'contract:staff_contract_detail' approval.staff_contract.pk %}" target="_blank">
                    {{ approval.staff_contract }} <i class="bi bi-box-arrow-up-right"></i>
                </a>
            </div>
        </div>
        <div class="row mb-3 align-items-center">
            <div class="col-sm-2 text-start text-sm-end"><strong>締期間</strong></div>
            <div class="col-sm-10">{{ approval.period_start|date:"Y/m/d" }} ～ {{ approval.period_end|date:"Y/m/d" }}</div>
        </div>
    </div>
</div>

<div class="content-box card bg-light mt-2 mb-4">
    <div class="card-header">勤務明細</div>
    <div class="card-body">
        <div class="table-responsive">
            <table class="table table-bordered table-sm table-hover">
                <thead class="table-light">
                    <tr>
                        <th>日付</th>
                        <th class="text-center">開始時刻</th>
                        <th class="text-center">終了時刻</th>
                        <th class="text-center">休憩合計</th>
                        <th class="text-center">勤務時間</th>
                        <th class="text-center">詳細</th>
                    </tr>
                </thead>
                <tbody>
                    {% for data in calendar_data %}
                    <tr class="{% if data.weekday == 5 %}table-saturday{% elif data.weekday == 6 or data.is_holiday %}table-sunday{% endif %}">
                        <td class="align-middle {% if data.weekday == 5 %}text-saturday{% elif data.weekday == 6 or data.is_holiday %}text-sunday{% endif %} fw-bold">
                            {{ data.date|date:"m/d" }} ({{ data.date|date:"D" }})
                        </td>
                        <td class="text-center align-middle">
                            {{ data.timerecord.rounded_start_time|date:"H:i"|default:"-" }}
                        </td>
                        <td class="text-center align-middle">
                            {{ data.timerecord.rounded_end_time|date:"H:i"|default:"-" }}
                        </td>
                        <td class="text-center align-middle">
                            {% if data.timerecord.total_break_minutes > 0 %}
                                {{ data.timerecord.break_hours_display }}
                            {% else %}
                                -
                            {% endif %}
                        </td>
                        <td class="text-center align-middle">
                            {% if data.timerecord.total_work_minutes > 0 %}
                                {{ data.timerecord.work_hours_display }}
                            {% else %}
                                -
                            {% endif %}
                        </td>
                        <td class="text-center align-middle">
                            {% if data.timerecord %}
                            <a href="{% url 'kintai:timerecord_detail' data.timerecord.pk %}" class="btn btn-sm btn-outline-secondary">
                                <i class="bi bi-eye"></i>
                            </a>
                            {% else %}
                            -
                            {% endif %}
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        <div class="d-flex justify-content-start mt-4">
            {% if approval.status == '20' %}
                <form action="{% url 'kintai:timerecord_approval_approve' approval.pk %}" method="POST" class="me-2" onsubmit="return confirm('この申請を承認しますか？');">
                    {% csrf_token %}
                    <button type="submit" class="btn btn-sm btn-success">承認する</button>
                </form>
                <form action="{% url 'kintai:timerecord_approval_reject' approval.pk %}" method="POST" class="me-2" onsubmit="return confirm('この申請を差戻しますか？');">
                    {% csrf_token %}
                    <button type="submit" class="btn btn-sm btn-danger">差戻す</button>
                </form>
            {% endif %}
            <a href="{% url 'kintai:timerecord_approval_list' %}" class="btn btn-sm btn-secondary">戻る</a>
        </div>
    </div>
</div>
{% endblock %}
