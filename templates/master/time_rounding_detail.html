{% extends 'common/_base.html' %}
{% load help_tags %}

{% block title %}時間丸めマスタ詳細{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="row">
        <div class="col-12">
            <div class="content-box card bg-light" style="max-width: 100%;">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <span>時間丸めマスタ詳細</span>
                    <div>
                        <a href="{% url 'master:time_rounding_edit' time_rounding.pk %}" class="btn btn-sm btn-warning">編集</a>
                        <a href="{% url 'master:time_rounding_delete_confirm' time_rounding.pk %}" class="btn btn-sm btn-dark">削除</a>
                    </div>
                </div>
                <div class="card-body">
                    <!-- 基本情報 -->
                    <div class="row mb-3">
                        <div class="col-sm-2">
                            <strong>名称:</strong>
                        </div>
                        <div class="col-sm-10">
                            {{ time_rounding.name }}
                        </div>
                    </div>

                    {% if time_rounding.description %}
                    <div class="row mb-3">
                        <div class="col-sm-2">
                            <strong>説明:</strong>
                        </div>
                        <div class="col-sm-10">
                            {{ time_rounding.description|linebreaks }}
                        </div>
                    </div>
                    {% endif %}

                    <!-- 開始時刻丸め設定 -->
                    <div class="row mb-3">
                        <div class="col-sm-2">
                            <strong>開始時刻丸め:</strong>
                        </div>
                        <div class="col-sm-10">
                            {{ time_rounding.start_time_unit }}分単位 / {{ time_rounding.get_start_time_method_display }}
                        </div>
                    </div>

                    <!-- 終了時刻丸め設定 -->
                    <div class="row mb-3">
                        <div class="col-sm-2">
                            <strong>終了時刻丸め:</strong>
                        </div>
                        <div class="col-sm-10">
                            {{ time_rounding.end_time_unit }}分単位 / {{ time_rounding.get_end_time_method_display }}
                        </div>
                    </div>

                    <!-- 休憩設定 -->
                    <div class="row mb-3">
                        <div class="col-sm-2">
                            <strong>休憩入力:</strong>
                        </div>
                        <div class="col-sm-10">
                            {% if time_rounding.break_input %}
                                <span class="badge bg-success">入力する</span>
                            {% else %}
                                <span class="badge bg-secondary">入力しない</span>
                            {% endif %}
                        </div>
                    </div>

                    {% if time_rounding.break_input %}
                    <!-- 休憩開始時刻丸め設定 -->
                    <div class="row mb-3">
                        <div class="col-sm-2">
                            <strong>休憩開始時刻丸め:</strong>
                        </div>
                        <div class="col-sm-10">
                            {{ time_rounding.break_start_unit }}分単位 / {{ time_rounding.get_break_start_method_display }}
                        </div>
                    </div>

                    <!-- 休憩終了時刻丸め設定 -->
                    <div class="row mb-3">
                        <div class="col-sm-2">
                            <strong>休憩終了時刻丸め:</strong>
                        </div>
                        <div class="col-sm-10">
                            {{ time_rounding.break_end_unit }}分単位 / {{ time_rounding.get_break_end_method_display }}
                        </div>
                    </div>
                    {% endif %}

                    <!-- その他の設定 -->
                    <div class="row mb-3">
                        <div class="col-sm-2">
                            <strong>有効:</strong>
                        </div>
                        <div class="col-sm-10">
                            {% if time_rounding.is_active %}
                                <span class="badge bg-success">有効</span>
                            {% else %}
                                <span class="badge bg-secondary">無効</span>
                            {% endif %}
                        </div>
                    </div>

                    <div class="row mb-3">
                        <div class="col-sm-2">
                            <strong>表示順:</strong>
                        </div>
                        <div class="col-sm-10">
                            {{ time_rounding.sort_order }}
                        </div>
                    </div>

                    <!-- 作成・更新情報 -->
                    <div class="row mb-3">
                        <div class="col-sm-2">
                            <strong>作成日時:</strong>
                        </div>
                        <div class="col-sm-4">
                            {{ time_rounding.created_at|date:"Y/m/d H:i:s" }}
                        </div>
                        <div class="col-sm-2">
                            <strong>更新日時:</strong>
                        </div>
                        <div class="col-sm-4">
                            {{ time_rounding.updated_at|date:"Y/m/d H:i:s" }}
                        </div>
                    </div>
                </div>
            </div>

            <!-- 変更履歴 -->
            <div class="content-box card bg-light mt-2 mb-4" style="max-width: 100%;">
                <div class="card-header d-flex justify-content-between align-items-center">
                    変更履歴
                </div>
                <div class="card-body mb-0">
                    {% if change_logs %}
                    <table class="table table-hover me-2 mt-2 mb-0" style="border-top: 1px solid #ddd;">
                        <thead>
                            <tr>
                                <th>対象</th>
                                <th>操作</th>
                                <th>変更内容</th>
                                <th>変更者</th>
                                <th>日時</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for log in change_logs %}
                            <tr>
                                <td>
                                    <span class="badge bg-primary">時間丸めマスタ</span>
                                </td>
                                <td>
                                    {% if log.action == 'create' %}
                                        <span class="badge bg-success">作成</span>
                                    {% elif log.action == 'update' %}
                                        <span class="badge bg-warning">編集</span>
                                    {% elif log.action == 'delete' %}
                                        <span class="badge bg-danger">削除</span>
                                    {% endif %}
                                </td>
                                <td>
                                    {% if log.changes %}
                                        {{ log.changes|truncatechars:50 }}
                                    {% else %}
                                        -
                                    {% endif %}
                                </td>
                                <td>{{ log.user.username|default:"-" }}</td>
                                <td>{{ log.created_at|date:"Y/m/d H:i:s" }}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                    {% else %}
                    <p class="text-muted">変更履歴がありません。</p>
                    {% endif %}
                </div>
            </div>

            <!-- 戻るボタン -->
            <div class="d-flex justify-content-start">
                <a href="{% url 'master:time_rounding_list' %}" class="btn btn-sm btn-secondary me-2">戻る</a>
            </div>
        </div>
    </div>
</div>
{% endblock %}