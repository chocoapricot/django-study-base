{% extends 'common/_base.html' %}
{% load static %}
{% load badge_tags %}

{% block content %}
<div class="content-box card bg-light mt-2 mb-4" style="max-width: 100%;">
    <div class="card-header d-flex justify-content-between align-items-center">
        通知一覧
        <div class="d-flex">
            {% if unread_count > 0 %}
            <form method="post" action="{% url 'system_notifications:mark_all_as_read' %}" style="display:inline;">
                {% csrf_token %}
                <button type="submit" class="btn btn-sm btn-primary">
                    <i class="bi bi-check-all me-1"></i>すべて既読にする
                </button>
            </form>
            {% endif %}
        </div>
    </div>
    <div class="card-body">
        <!-- 検索結果情報 -->
        <div class="alert alert-info alert-sm mb-3">
            <i class="bi bi-info-circle"></i>
            全件表示: {{ page_obj.paginator.count }}件
            {% if unread_count > 0 %}
            <span class="badge bg-warning text-dark ms-2">未読 {{ unread_count }} 件</span>
            {% endif %}
        </div>

        <table class="table table-striped table-hover me-2 mt-2" style="border-top: 1px solid #ddd;">
            <thead>
                <tr>
                    <th>状態</th>
                    <th>種別</th>
                    <th>タイトル</th>
                    <th>メッセージ</th>
                    <th>作成日時</th>
                </tr>
            </thead>
            <tbody>
                {% for notification in page_obj %}
                <tr class="{% if not notification.is_read %}fw-bold{% endif %}">
                    <td>
                        {% if not notification.is_read %}
                            <span class="badge bg-warning text-dark">未読</span>
                        {% else %}
                            <span class="badge bg-secondary">既読</span>
                        {% endif %}
                    </td>
                    <td>
                        <span class="badge {{ notification.notification_type|notification_type_badge_class }}">
                            <i class="bi {{ notification.notification_type|notification_type_icon }} me-1"></i>{{ notification.notification_type_display_name }}
                        </span>
                    </td>
                    <td>
                        <a href="{% url 'system_notifications:notification_detail' notification.pk %}" class="{% if not notification.is_read %}fw-bold{% endif %}">
                            {{ notification.title }}
                        </a>
                    </td>
                    <td style="max-width:400px;word-break:break-all;">
                        {{ notification.message|truncatewords:15 }}
                    </td>
                    <td class="text-nowrap">{{ notification.created_at|date:"Y/m/d H:i:s" }}</td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="5" class="text-center">通知はありません</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>

        <div>
            {% include 'common/_pagination.html' with page_obj=page_obj %}
        </div>
    </div>
</div>
{% endblock %}
