{% extends 'common/_base.html' %}
{% load static %}

{% block content %}
<div class="content-box card bg-light mt-2 mb-4" style="max-width: 100%;">
    <div class="card-header d-flex justify-content-between align-items-center">
        通知一覧
        <div class="d-flex">
            {% if unread_count > 0 %}
            <form method="post" action="{% url 'system_notifications:mark_all_as_read' %}" style="display:inline;">
                {% csrf_token %}
                <button type="submit" class="btn btn-sm btn-primary">
                    <i class="bi bi-check-all me-1"></i>すべて既読にする
                </button>
            </form>
            {% endif %}
        </div>
    </div>
    <div class="card-body">
        <!-- 検索結果情報 -->
        <div class="alert alert-info alert-sm mb-3">
            <i class="bi bi-info-circle"></i>
            全件表示: {{ page_obj.paginator.count }}件
            {% if unread_count > 0 %}
            <span class="badge bg-warning text-dark ms-2">未読 {{ unread_count }} 件</span>
            {% endif %}
        </div>

        <table class="table table-striped table-hover me-2 mt-2" style="border-top: 1px solid #ddd;">
            <thead>
                <tr>
                    <th style="width: 60px;">状態</th>
                    <th style="width: 100px;">種別</th>
                    <th>タイトル</th>
                    <th>メッセージ</th>
                    <th style="width: 150px;">作成日時</th>
                </tr>
            </thead>
            <tbody>
                {% for notification in page_obj %}
                <tr {% if not notification.is_read %}class="table-warning"{% endif %}>
                    <td>
                        {% if not notification.is_read %}
                            <span class="badge bg-warning text-dark">未読</span>
                        {% else %}
                            <span class="badge bg-secondary">既読</span>
                        {% endif %}
                    </td>
                    <td>
                        {% if notification.notification_type == 'alert' %}
                            <i class="bi bi-exclamation-triangle-fill text-danger me-1"></i>
                            <span class="text-danger">アラート</span>
                        {% elif notification.notification_type == 'warning' %}
                            <i class="bi bi-exclamation-circle-fill text-warning me-1"></i>
                            <span class="text-warning">警告</span>
                        {% elif notification.notification_type == 'info' %}
                            <i class="bi bi-info-circle-fill text-info me-1"></i>
                            <span class="text-info">情報</span>
                        {% else %}
                            <i class="bi bi-bell-fill text-primary me-1"></i>
                            <span class="text-primary">一般</span>
                        {% endif %}
                    </td>
                    <td>
                        <a href="{% url 'system_notifications:notification_detail' notification.pk %}">
                            {{ notification.title }}
                        </a>
                    </td>
                    <td style="max-width:400px;word-break:break-all;">
                        {{ notification.message|truncatewords:15 }}
                    </td>
                    <td>{{ notification.created_at|date:"Y/m/d H:i:s" }}</td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="5" class="text-center">通知はありません</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>

        <div>
            {% include 'common/_pagination.html' with page_obj=page_obj %}
        </div>
    </div>
</div>
{% endblock %}
