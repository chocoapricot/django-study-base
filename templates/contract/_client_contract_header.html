{% load humanize %}
{% load help_tags %}
{% load dropdowns %}
{% load badge_tags %}

<div class="row">
    <div class="col-md-6">
        <h6 class="text-muted mb-3">基本情報</h6>
        <table class="table table-sm">
            <tr>
                <th>契約番号</th>
                <td>{{ contract.contract_number|default:"-" }}</td>
            </tr>
            <tr>
                <th>クライアント</th>
                <td>
                    <a href="{% url 'client:client_detail' contract.client.pk %}" class="text-decoration-none" target="_blank">
                        {{ contract.client.name }}
                        <i class="bi bi-box-arrow-up-right ms-1"></i>
                    </a>
                </td>
            </tr>
            <tr>
                <th class="w-25">契約名</th>
                <td>{{ contract.contract_name }}</td>
            </tr>
            <tr>
                <th>職種</th>
                <td>
                    {{ contract.job_category.name|default:"-" }}
                    {% if contract.client_contract_type_code == Constants.CLIENT_CONTRACT_TYPE.DISPATCH and contract.duration <= 30 and contract.job_category.jobs_seirei %}
                        <span class="badge bg-light">日雇派遣例外業務</span>
                        {% my_help_icon "日雇派遣（30日以内または週20時間未満の派遣）ですが、令第４条第１項に該当する業務のため例外となります" %}
                    {% endif %}
                </td>
            </tr>
            <tr>
                <th>契約状況</th>
                <td>
                    <span class="badge {{ contract.contract_status|badge_class }}">
                        {% my_name 'contract_status' contract.contract_status %}
                    </span>
                </td>
            </tr>
        </table>
    </div>
    <div class="col-md-6">
        <h6 class="text-muted mb-3">契約条件</h6>
        <table class="table table-sm">
            <tr>
                <th class="w-25">
                    {% if contract.contract_pattern.contract_type_code == Constants.CLIENT_CONTRACT_TYPE.DISPATCH %}
                        派遣期間
                    {% else %}
                        契約期間
                    {% endif %}
                </th>
                <td>
                    {{ contract.start_date|date:"Y年m月d日" }}
                     ～ 
                    {% if contract.end_date %}
                        {{ contract.end_date|date:"Y年m月d日" }}
                    {% else %}
                        無期限
                    {% endif %}
                    {% if contract.client_contract_type_code == Constants.CLIENT_CONTRACT_TYPE.DISPATCH and contract.duration <= 30 %}
                        {% if contract.job_category.jobs_seirei %}
                            <span class="badge bg-light">日雇派遣例外</span>
                            {% my_help_icon "日雇派遣（30日以内または週20時間未満の派遣）ですが、令第４条第１項に該当する業務のため例外となります" %}
                        {% elif contract.haken_info and contract.haken_info.limit_indefinite_or_senior == Constants.LIMIT_BY_AGREEMENT.LIMITED %}
                            <span class="badge bg-light">日雇派遣例外</span>
                            {% my_help_icon "日雇派遣（30日以内または週20時間未満の派遣）ですが、無期雇用派遣労働者又は60歳以上の者に限定されているため例外となります" %}
                        {% else %}
                            <span class="badge bg-danger">日雇派遣</span>
                            {% my_help_icon "日雇派遣（30日以内または週20時間未満の派遣）となり、就業するスタッフの条件に制約があります" %}
                        {% endif %}
                    {% endif %}
                </td>
            </tr>
            <tr>
                <th>就業時間</th>
                <td>
                    {% if contract.worktime_pattern %}
                        <div class="small text-muted">{{ contract.worktime_pattern.name }}</div>
                        {% if contract.worktime_pattern.work_times.all %}
                            {% for wt in contract.worktime_pattern.work_times.all %}
                                <div>
                                    {% if wt.time_name %}{{ wt.time_name.content }}: {% endif %}{% if wt.start_time_next_day %}翌{% endif %}{{ wt.start_time|time:"H:i" }}-{% if wt.end_time_next_day %}翌{% endif %}{{ wt.end_time|time:"H:i" }}
                                    {% if wt.break_times.all %}
                                        <span class="small text-muted">(休憩: {% for bt in wt.break_times.all %}{% if not forloop.first %}, {% endif %}{% if bt.start_time_next_day %}翌{% endif %}{{ bt.start_time|time:"H:i" }}-{% if bt.end_time_next_day %}翌{% endif %}{{ bt.end_time|time:"H:i" }}{% endfor %})</span>
                                    {% endif %}
                                </div>
                            {% endfor %}
                        {% endif %}
                    {% else %}
                        -
                    {% endif %}
                </td>
            </tr>
            <tr>
                <th>契約金額</th>
                <td>
                    {% if contract.contract_amount %}
                        {% my_name 'bill_unit' contract.bill_unit %}
                        ¥{{ contract.contract_amount|floatformat:0|intcomma }}
                    {% else %}
                        -
                    {% endif %}
                </td>
            </tr>
            <tr>
                <th>契約種別</th>
                <td>
                    <span class="badge {{contract.client_contract_type_code|badge_class}}">
                        {{ contract.contract_type_display_name }}
                    </span>
                    {{ contract.contract_pattern.name|default:"-" }}
                </td>
            </tr>
            <tr>
                <th>支払条件</th>
                <td>
                    {% if contract.payment_site %}
                        {{ contract.payment_site.name }}
                    {% else %}
                        -
                    {% endif %}
                </td>
            </tr>
        </table>
    </div>
</div>