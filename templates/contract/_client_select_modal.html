<script>window.parentModalType = window.parentModalType || 'standardTestModal';</script>
{% load help_tags %}

<small class="text-muted">※基本契約が締結されているクライアントのみ表示されます</small>
<!-- 検索フォーム -->
<form id="client-search-form" method="get" class="mb-3" onsubmit="loadClientModalContent(event, 1)">
    <div class="row">
        <div class="col-md-8">
            <input type="text" name="q" value="{{ search_query }}" class="form-control form-control-sm" placeholder="クライアント名、法人番号で検索">
        </div>
        <div class="col-md-4">
            <button type="submit" class="btn btn-sm btn-primary me-2">検索</button>
            <a href="#" onclick="var q=document.querySelector('input[name=\'q\']');if(q){q.value='';}if(window.parentModalType){loadClientModalContent(event, 1, true, window.parentModalType);}else{loadClientModalContent(event, 1, true);} return false;" class="btn btn-sm btn-secondary">クリア</a>
        </div>
    </div>
</form>

<!-- クライアント一覧 -->
<div class="table-responsive">
    <table class="table table-hover">
        <thead>
            <tr>
                <th>クライアント名</th>
                <th>
                    法人番号
                    {% my_help_preset "corporate_number" %}
                </th>
                <th>
                    基本契約日
                    {% my_help_preset "client_selection" %}
                </th>
                <th>操作</th>
            </tr>
        </thead>
        <tbody>
            {% for client in page_obj.object_list %}
            <tr>
                <td>{{ client.name }}</td>
                <td>
                    {{ client.corporate_number|default:"-" }}
                </td>
                <td>
                    {% if client_contract_type_code == Constants.CLIENT_CONTRACT_TYPE.DISPATCH %}
                        {{ client.basic_contract_date_haken|default:"-" }}
                    {% else %}
                        {{ client.basic_contract_date|default:"-" }}
                    {% endif %}
                </td>
                <td>
                    <button type="button" class="btn btn-sm btn-primary" onclick="selectClient('{{ client.pk }}', '{{ client.name|escapejs }}')">
                        選択
                    </button>
                </td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="4" class="text-center text-muted">該当するクライアントが見つかりません</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

{% include 'common/_pagination.html' %}

<script>
// ツールチップを有効化
document.addEventListener('DOMContentLoaded', function() {
    var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
    var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
        return new bootstrap.Tooltip(tooltipTriggerEl);
    });
});
</script>
