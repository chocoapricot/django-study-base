<script>window.parentModalType = window.parentModalType || 'standardTestModal';</script>
{% load help_tags %}

<small class="text-muted">※基本契約が締結されているクライアントのみ表示されます</small>
<!-- 検索フォーム -->
<form id="client-search-form" method="get" class="mb-3" onsubmit="loadClientModalContent(event, 1)">
    <div class="row">
        <div class="col-md-8">
            <input type="text" name="q" value="{{ search_query }}" class="form-control form-control-sm" placeholder="クライアント名、法人番号で検索">
        </div>
        <div class="col-md-4">
            <button type="submit" class="btn btn-sm btn-primary me-2">検索</button>
            <a href="#" onclick="var q=document.querySelector('input[name=\'q\']');if(q){q.value='';}if(window.parentModalType){loadClientModalContent(event, 1, true, window.parentModalType);}else{loadClientModalContent(event, 1, true);} return false;" class="btn btn-sm btn-secondary">クリア</a>
        </div>
    </div>
</form>

<!-- クライアント一覧 -->
<div class="table-responsive">
    <table class="table table-hover">
        <thead>
            <tr>
                <th>クライアント名</th>
                <th>
                    法人番号
                    {% my_help_preset "corporate_number" %}
                </th>
                <th>
                    基本契約日
                    {% my_help_preset "client_selection" %}
                </th>
                <th>操作</th>
            </tr>
        </thead>
        <tbody>
            {% for client in clients %}
            <tr>
                <td>{{ client.name }}</td>
                <td>
                    <strong>{{ client.corporate_number|default:"-" }}</strong>
                </td>
                <td>
                    {% if client.basic_contract_date %}
                        <strong>{{ client.basic_contract_date }}</strong> (基本)
                    {% endif %}
                    {% if client.basic_contract_date_haken %}
                        <br><strong>{{ client.basic_contract_date_haken }}</strong> (派遣)
                    {% endif %}
                </td>
                <td>
                    <button type="button" class="btn btn-sm btn-primary" onclick="selectClient('{{ client.pk }}', '{{ client.name|escapejs }}')">
                        選択
                    </button>
                </td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="4" class="text-center text-muted">該当するクライアントが見つかりません</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<!-- ページネーション -->
{% if clients.has_other_pages %}
<nav aria-label="ページネーション">
    <ul class="pagination pagination-sm justify-content-center">
        {% if clients.has_previous %}
            <li class="page-item">
                <a class="page-link" href="#" onclick="loadClientModalContent(event, {{ clients.previous_page_number }})">前へ</a>
            </li>
        {% endif %}

        {% for num in clients.paginator.page_range %}
            {% if clients.number == num %}
                <li class="page-item active">
                    <span class="page-link">{{ num }}</span>
                </li>
            {% elif num > clients.number|add:'-3' and num < clients.number|add:'3' %}
                <li class="page-item">
                    <a class="page-link" href="#" onclick="loadClientModalContent(event, {{ num }})">{{ num }}</a>
                </li>
            {% endif %}
        {% endfor %}

        {% if clients.has_next %}
            <li class="page-item">
                <a class="page-link" href="#" onclick="loadClientModalContent(event, {{ clients.next_page_number }})">次へ</a>
            </li>
        {% endif %}
    </ul>
</nav>
{% endif %}

<script>
// ツールチップを有効化
document.addEventListener('DOMContentLoaded', function() {
    var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
    var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
        return new bootstrap.Tooltip(tooltipTriggerEl);
    });
});
</script>
