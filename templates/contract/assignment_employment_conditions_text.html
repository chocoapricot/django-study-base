{% extends 'common/_base.html' %}
{% load static %}

{% block title %}{{ document_title }} - テキスト表示{% endblock %}

{% block content %}
<div class="content-box card bg-light mt-2 mb-4" style="max-width: 100%;">
    <div class="card-header d-flex justify-content-between align-items-center">
        <span>{{ document_title }} - テキスト表示</span>
        <div>
            <button id="copyButton" onclick="copyToClipboard(event)" class="btn btn-sm btn-primary">
                <i class="bi bi-clipboard"></i> コピー
            </button>
        </div>
    </div>
    <div class="card-body">
        <div class="alert alert-info mb-3">
            <i class="bi bi-info-circle"></i> このテキストはメールに貼り付けて使用できます。「コピー」ボタンでクリップボードにコピーできます。
        </div>

        <!-- プレーンテキスト表示エリア -->
        <pre id="contractText" style="background-color: #f8f9fa; padding: 20px; border: 1px solid #dee2e6; border-radius: 4px; white-space: pre-wrap; word-wrap: break-word; font-family: 'Courier New', monospace; font-size: 14px; line-height: 1.6;">{% if assignment.staff_contract.contract_status == '10' or assignment.staff_contract.contract_status == '20' %}━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
【ドラフト版】
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

{% endif %}{{ document_title }}

{% if intro_text %}{{ intro_text }}

{% endif %}━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
就業条件
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
{% for item in items %}
■ {{ item.title }}
{{ item.text }}
{% endfor %}
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

契約番号: {{ assignment.client_contract.contract_number|default:"未採番" }}
契約名: {{ assignment.client_contract.contract_name }}
スタッフ: {{ assignment.staff_contract.staff.name_last }} {{ assignment.staff_contract.staff.name_first }}
</pre>
    </div>
</div>

<script>
function copyToClipboard(event) {
    const text = document.getElementById('contractText').textContent;
    const btn = event.currentTarget;
    
    navigator.clipboard.writeText(text).then(function() {
        // ボタンの表示を変更
        const originalHTML = btn.innerHTML;
        btn.innerHTML = '<i class="bi bi-check"></i> コピーしました';
        btn.classList.remove('btn-primary');
        btn.classList.add('btn-success');
        
        // 3秒後に元に戻す
        setTimeout(function() {
            btn.innerHTML = originalHTML;
            btn.classList.remove('btn-success');
            btn.classList.add('btn-primary');
        }, 3000);
    }, function(err) {
        alert('コピーに失敗しました: ' + err);
    });
}
</script>
{% endblock %}
