{% extends 'common/_base.html' %}
{% load static %}
{% load humanize %}
{% load dropdowns %}
{% load badge_tags %}

{% block title %}スタッフ契約確認{% endblock %}

{% block content %}
<div class="content-box card bg-light mt-2 mb-4" style="max-width: 100%;">
    <div class="card-header d-flex justify-content-between align-items-center">
        スタッフ契約確認
    </div>
    <div class="card-body">
        <!-- 契約確認一覧テーブル -->
        {% if confirm_items %}
        <table class="table table-striped table-hover me-2 mt-2" style="border-top: 1px solid #ddd;">
            <thead class="table-light">
                <tr>
                    <th>書類種別</th>
                    <th>契約名</th>
                    <th>契約番号</th>
                    <th>発行日時</th>
                    <th>PDF</th>
                    <th>確認状況</th>
                    <th>確認日時</th>
                    <th>操作</th>
                </tr>
            </thead>
            <tbody>
                {% for item in confirm_items %}
                <tr>
                    <td>
                        {% if item.type == 'staff_contract' %}
                            <span class="badge bg-primary">スタッフ契約書</span>
                        {% elif item.type == 'employment_conditions' %}
                            <span class="badge bg-info">就業条件明示書</span>
                            <br><small class="text-muted">{{ item.assignment.client_contract.client.name }}</small>
                        {% endif %}
                    </td>
                    <td>{{ item.contract.contract_name }}</td>
                    <td>
                        {% if item.type == 'staff_contract' %}
                            {{ item.contract.contract_number|default:"-" }}
                        {% elif item.type == 'employment_conditions' %}
                            {{ item.latest_pdf.contract_number|default:"-" }}
                        {% endif %}
                    </td>
                    <td>{{ item.latest_pdf.printed_at|date:"Y/m/d H:i:s"|default:"-" }}</td>
                    <td>
                        {% if item.type == 'staff_contract' and item.latest_pdf %}
                            <a href="{% url 'contract:view_staff_contract_pdf' item.latest_pdf.pk %}" target="_blank" class="btn btn-sm btn-info">PDF表示</a>
                        {% elif item.type == 'employment_conditions' and item.latest_pdf %}
                            <a href="{% url 'contract:view_assignment_haken_print_pdf' item.latest_pdf.pk %}" target="_blank" class="btn btn-sm btn-info">PDF表示</a>
                        {% endif %}
                    </td>
                    <td>
                        {% if item.is_confirmed %}
                            <span class="badge bg-success">確認済み</span>
                        {% else %}
                            <span class="badge bg-warning">未確認</span>
                        {% endif %}
                    </td>
                    <td>{{ item.confirmed_at|date:"Y/m/d H:i:s"|default:"-" }}</td>
                    <td>
                        {% if not item.is_confirmed %}
                            <form method="post" action="{% url 'contract:staff_contract_confirm_list' %}" class="d-inline">
                                {% csrf_token %}
                                {% if item.type == 'staff_contract' %}
                                    <input type="hidden" name="contract_id" value="{{ item.contract.pk }}">
                                    <input type="hidden" name="action" value="confirm_staff_contract">
                                {% elif item.type == 'employment_conditions' %}
                                    <input type="hidden" name="assignment_id" value="{{ item.assignment.pk }}">
                                    <input type="hidden" name="action" value="confirm_employment_conditions">
                                {% endif %}
                                <button type="submit" class="btn btn-sm btn-primary">確認</button>
                            </form>
                        {% else %}
                            -
                        {% endif %}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        {% include 'common/_pagination.html' %}
        {% else %}
        <div class="text-center py-4">
            <p class="text-muted">確認対象の書類が見つかりませんでした。</p>
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}
